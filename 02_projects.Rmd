# Projects

## Notes

Image from workflow talk shows having many R/RStudio instances open at once, all in different projects. <https://speakerdeck.com/jennybc/zen-and-the-art-of-workflow-maintenance?slide=44>

*pieces of blog post, for reworking here*

## Workflow versus Product

Let's make a distinction between things you do because of personal taste and habits ("workflow") versus the logic and output that is the essence of your project ("product"). These are part of your workflow:

  * The editor you use to write your R code.
  * The name of your home directory.
  * The R code you ran before lunch.
  
I consider these to be clearly product:

  * The raw data.
  * The R code someone needs to run on your raw data to get your results, including the explicit `library()` calls to load necessary packages.
  
Ideally, you don't hardwire anything about your workflow into your product. Workflow-related operations should be executed by you interactively, using whatever means is appropriate to your setup, but not built into the scripts themselves.

## Self-contained projects

I suggest organizing each data analysis into a *project*: a folder on your computer that holds all the files relevant to that particular piece of work. I'm **not** assuming this is an [RStudio Project](https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects), though this is a nice implementation discussed below.

Any resident R script is written assuming that it will be run from a fresh R process with working directory set to the project directory. It creates everything it needs, in its own workspace or folder, and it touches nothing it did not create. For example, it does not install additional packages (another pet peeve of mine).

This convention guarantees that the project can be moved around on your computer or onto other computers and will still "just work". I argue that this is the only practical convention that creates reliable, polite behavior across different computers or users and over time. This convention is neither new, nor unique to R.

It's like agreeing that we will all drive on the left or the right. A hallmark of civilization is following conventions that constrain your behavior a little, in the name of public safety.

## What's wrong with `setwd()`?

I run a lot of student code in [STAT 545](http://stat545.com) and, at the start, I see a lot of R scripts that look like this:


```{r, eval = FALSE}
library(ggplot2)
setwd("/Users/jenny/cuddly_broccoli/verbose_funicular/foofy/data")
df <- read.delim("raw_foofy_data.csv")
p <- ggplot(df, aes(x, y)) + geom_point()
ggsave("../figs/foofy_scatterplot.png")
```


The chance of the `setwd()` command having the desired effect -- making the file paths work -- for anyone besides its author is 0%. It's also unlikely to work for the author one or two years or computers from now. The project is not self-contained and portable. To recreate and perhaps extend this plot, the lucky recipient will need to hand edit one or more paths to reflect where the project has landed on their machine. When you do this for the 73rd time in 2 days, while marking an assignment, you start to fantasize about lighting the perpetrator's computer on fire.

This use of `setwd()` is also highly suggestive that the useR does all of their work in one R process and manually switches gears when they shift from one project to another. That sort of workflow makes it unpleasant to work on more than one project at a time and also makes it easy for work done on one project to accidentally leak into subsequent work on another (e.g., objects, loaded packages, session options).

## Use projects and the [here package](https://CRAN.R-project.org/package=here)

How can you avoid `setwd()` at the top of every script?

  * Organize each logical project into a folder on your computer.
  * Make sure the top-level folder advertises itself as such. This can be as simple as having an empty file named `.here`. Or, if you use RStudio and/or Git, those both leave characteristic files behind that will get the job done.
  * Use the `here()` function from the [here package](https://CRAN.R-project.org/package=here) to build the path when you read or write a file. Create paths relative to the top-level directory.
  * Whenever you work on this project, launch the R process from the project's top-level directory. If you launch R from the shell, `cd` to the correct folder first.
  
To continue our example, start R in the `foofy` directory, wherever that may be. Now the code looks like so:


```{r, eval = FALSE}
library(ggplot2)
library(here)

df <- read.delim(here("data", "raw_foofy_data.csv"))
p <- ggplot(df, aes(x, y)) + geom_point()
ggsave(here("figs", "foofy_scatterplot.png"))
```


This will run, with no edits, for anyone who follows the convention about launching R in the project folder. In fact, it will even work if R's working directory is anywhere inside the project, i.e. it will work from sub-folders. This plays well with knitr/rmarkdown's default behavior around working directory and in package development/checking workflows.

Read up on the [here package](https://CRAN.R-project.org/package=here) to learn
about more features, such as additional ways to mark the top directory and
troubleshooting with `dr_here()`. I have also written a [more detailed
paean](https://github.com/jennybc/here_here) to this package before.

## RStudio Projects

This work style is so crucial that RStudio has an official notion of a [Project](https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects) (with a capital "P"). You can designate a new or existing folder as a Project. All this means is that RStudio leaves a file, e.g., `foofy.Rproj`, in the folder, which is used to store settings specific to that project.

Double-click on a `.Rproj` file to open a fresh instance of RStudio, with the working directory and file browser pointed at the project folder. The here package is aware of this and the presence of an `.Rproj` is one of the ways it recognizes the top-level folder for a project. 

RStudio fully supports Project-based workflows, making it easy to switch from one to another, have many projects open at once, re-launch recently used Projects, etc.
